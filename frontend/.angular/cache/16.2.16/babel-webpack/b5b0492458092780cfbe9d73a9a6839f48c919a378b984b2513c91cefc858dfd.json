{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { Subscription } from 'rxjs';\nexport let RealizarEnvioComponent = class RealizarEnvioComponent {\n  constructor(authService, router, http) {\n    this.authService = authService;\n    this.router = router;\n    this.http = http;\n    this.subscription = new Subscription();\n    this.apiUrl = 'http://localhost:3005/api';\n    this.currentUser = null;\n    this.isLoading = false;\n    this.isSubmitting = false;\n    this.errorMessage = '';\n    this.successMessage = '';\n    this.currentStep = 1;\n    this.totalSteps = 4;\n    this.shipmentForm = {\n      sender: {\n        name: '',\n        phone: '',\n        email: '',\n        document_type: 'DPI',\n        document_number: ''\n      },\n      receiver: {\n        name: '',\n        phone: '',\n        email: '',\n        document_type: 'DPI',\n        document_number: ''\n      },\n      package_details: {\n        description: '',\n        weight: 0,\n        dimensions: {\n          length: 0,\n          width: 0,\n          height: 0\n        },\n        declared_value: 0,\n        fragile: false,\n        special_handling: ''\n      },\n      addresses: {\n        origin: {\n          department: '',\n          municipality: '',\n          address: '',\n          zone: '',\n          reference: ''\n        },\n        destination: {\n          department: '',\n          municipality: '',\n          address: '',\n          zone: '',\n          reference: ''\n        }\n      },\n      service_type: 'standard',\n      priority: 'normal',\n      delivery_date: '',\n      notes: ''\n    };\n    // Opciones para selects\n    this.documentTypes = [{\n      value: 'DPI',\n      label: 'DPI'\n    }, {\n      value: 'NIT',\n      label: 'NIT'\n    }, {\n      value: 'Passport',\n      label: 'Pasaporte'\n    }];\n    this.serviceTypes = [{\n      value: 'standard',\n      label: 'Estándar (3-5 días)',\n      price: 'Base'\n    }, {\n      value: 'express',\n      label: 'Express (1-2 días)',\n      price: '+50%'\n    }, {\n      value: 'overnight',\n      label: 'Overnight (24 horas)',\n      price: '+100%'\n    }];\n    this.priorities = [{\n      value: 'low',\n      label: 'Baja',\n      color: '#28a745'\n    }, {\n      value: 'normal',\n      label: 'Normal',\n      color: '#007bff'\n    }, {\n      value: 'high',\n      label: 'Alta',\n      color: '#ffc107'\n    }, {\n      value: 'urgent',\n      label: 'Urgente',\n      color: '#dc3545'\n    }];\n    // Departamentos de Guatemala\n    this.departments = ['Alta Verapaz', 'Baja Verapaz', 'Chimaltenango', 'Chiquimula', 'Petén', 'El Progreso', 'Quiché', 'Escuintla', 'Guatemala', 'Huehuetenango', 'Izabal', 'Jalapa', 'Jutiapa', 'Quetzaltenango', 'Retalhuleu', 'Sacatepéquez', 'San Marcos', 'Santa Rosa', 'Sololá', 'Suchitepéquez', 'Totonicapán', 'Zacapa'];\n  }\n  ngOnInit() {\n    this.loadUserData();\n    this.setMinDeliveryDate();\n  }\n  ngOnDestroy() {\n    this.subscription.unsubscribe();\n  }\n  loadUserData() {\n    this.subscription.add(this.authService.currentUser$.subscribe(user => {\n      this.currentUser = user;\n      if (user) {\n        // Pre-llenar datos del usuario actual como remitente por defecto\n        this.prefillSenderData(user);\n      }\n    }));\n  }\n  prefillSenderData(user) {\n    this.shipmentForm.sender.name = user.name;\n    this.shipmentForm.sender.email = user.email;\n  }\n  setMinDeliveryDate() {\n    const tomorrow = new Date();\n    tomorrow.setDate(tomorrow.getDate() + 1);\n    this.shipmentForm.delivery_date = tomorrow.toISOString().split('T')[0];\n  }\n  // Navegación entre pasos\n  nextStep() {\n    if (this.validateCurrentStep()) {\n      if (this.currentStep < this.totalSteps) {\n        this.currentStep++;\n        this.clearMessages();\n      }\n    }\n  }\n  prevStep() {\n    if (this.currentStep > 1) {\n      this.currentStep--;\n      this.clearMessages();\n    }\n  }\n  goToStep(step) {\n    if (step >= 1 && step <= this.totalSteps) {\n      this.currentStep = step;\n      this.clearMessages();\n    }\n  }\n  // Validaciones\n  validateCurrentStep() {\n    this.clearMessages();\n    switch (this.currentStep) {\n      case 1:\n        return this.validateSenderReceiver();\n      case 2:\n        return this.validatePackageDetails();\n      case 3:\n        return this.validateAddresses();\n      case 4:\n        return this.validateServiceOptions();\n      default:\n        return false;\n    }\n  }\n  validateSenderReceiver() {\n    const {\n      sender,\n      receiver\n    } = this.shipmentForm;\n    if (!sender.name.trim()) {\n      this.errorMessage = 'El nombre del remitente es requerido';\n      return false;\n    }\n    if (!sender.phone.trim()) {\n      this.errorMessage = 'El teléfono del remitente es requerido';\n      return false;\n    }\n    if (!sender.document_number.trim()) {\n      this.errorMessage = 'El número de documento del remitente es requerido';\n      return false;\n    }\n    if (!receiver.name.trim()) {\n      this.errorMessage = 'El nombre del destinatario es requerido';\n      return false;\n    }\n    if (!receiver.phone.trim()) {\n      this.errorMessage = 'El teléfono del destinatario es requerido';\n      return false;\n    }\n    if (!receiver.document_number.trim()) {\n      this.errorMessage = 'El número de documento del destinatario es requerido';\n      return false;\n    }\n    return true;\n  }\n  validatePackageDetails() {\n    const {\n      package_details\n    } = this.shipmentForm;\n    if (!package_details.description.trim()) {\n      this.errorMessage = 'La descripción del paquete es requerida';\n      return false;\n    }\n    if (package_details.weight <= 0) {\n      this.errorMessage = 'El peso debe ser mayor a 0';\n      return false;\n    }\n    if (package_details.dimensions.length <= 0 || package_details.dimensions.width <= 0 || package_details.dimensions.height <= 0) {\n      this.errorMessage = 'Todas las dimensiones deben ser mayores a 0';\n      return false;\n    }\n    if (package_details.declared_value <= 0) {\n      this.errorMessage = 'El valor declarado debe ser mayor a 0';\n      return false;\n    }\n    return true;\n  }\n  validateAddresses() {\n    const {\n      origin,\n      destination\n    } = this.shipmentForm.addresses;\n    if (!origin.department || !origin.municipality || !origin.address.trim()) {\n      this.errorMessage = 'Todos los campos de dirección de origen son requeridos';\n      return false;\n    }\n    if (!destination.department || !destination.municipality || !destination.address.trim()) {\n      this.errorMessage = 'Todos los campos de dirección de destino son requeridos';\n      return false;\n    }\n    return true;\n  }\n  validateServiceOptions() {\n    if (!this.shipmentForm.service_type) {\n      this.errorMessage = 'Debe seleccionar un tipo de servicio';\n      return false;\n    }\n    if (!this.shipmentForm.priority) {\n      this.errorMessage = 'Debe seleccionar una prioridad';\n      return false;\n    }\n    if (!this.shipmentForm.delivery_date) {\n      this.errorMessage = 'Debe seleccionar una fecha de entrega';\n      return false;\n    }\n    return true;\n  }\n  // Envío del formulario\n  onSubmit() {\n    if (!this.validateCurrentStep()) {\n      return;\n    }\n    this.isSubmitting = true;\n    this.clearMessages();\n    const shipmentData = {\n      ...this.shipmentForm,\n      user_id: this.currentUser?.id,\n      created_by_role: this.currentUser?.role\n    };\n    this.subscription.add(this.http.post(`${this.apiUrl}/shipments`, shipmentData).subscribe({\n      next: response => {\n        this.isSubmitting = false;\n        if (response.success) {\n          this.successMessage = `¡Envío creado exitosamente! ID: ${response.shipment?.shipment_id}`;\n          // Esperar 3 segundos y redirigir\n          setTimeout(() => {\n            this.router.navigate(['/rastreo'], {\n              queryParams: {\n                id: response.shipment?.shipment_id\n              }\n            });\n          }, 3000);\n        } else {\n          this.errorMessage = response.message || 'Error al crear el envío';\n        }\n      },\n      error: error => {\n        this.isSubmitting = false;\n        if (error.status === 401) {\n          this.errorMessage = 'No tienes permisos para crear envíos';\n          this.router.navigate(['/login']);\n        } else if (error.status === 400) {\n          this.errorMessage = error.error?.message || 'Datos del formulario inválidos';\n        } else {\n          this.errorMessage = 'Error interno del servidor. Intenta nuevamente.';\n        }\n        console.error('Error creating shipment:', error);\n      }\n    }));\n  }\n  // Utilidades\n  clearMessages() {\n    this.errorMessage = '';\n    this.successMessage = '';\n  }\n  resetForm() {\n    this.currentStep = 1;\n    this.shipmentForm = {\n      sender: {\n        name: '',\n        phone: '',\n        email: '',\n        document_type: 'DPI',\n        document_number: ''\n      },\n      receiver: {\n        name: '',\n        phone: '',\n        email: '',\n        document_type: 'DPI',\n        document_number: ''\n      },\n      package_details: {\n        description: '',\n        weight: 0,\n        dimensions: {\n          length: 0,\n          width: 0,\n          height: 0\n        },\n        declared_value: 0,\n        fragile: false,\n        special_handling: ''\n      },\n      addresses: {\n        origin: {\n          department: '',\n          municipality: '',\n          address: '',\n          zone: '',\n          reference: ''\n        },\n        destination: {\n          department: '',\n          municipality: '',\n          address: '',\n          zone: '',\n          reference: ''\n        }\n      },\n      service_type: 'standard',\n      priority: 'normal',\n      delivery_date: '',\n      notes: ''\n    };\n    if (this.currentUser) {\n      this.prefillSenderData(this.currentUser);\n    }\n    this.setMinDeliveryDate();\n    this.clearMessages();\n  }\n  getStepTitle(step) {\n    const titles = {\n      1: 'Datos Personales',\n      2: 'Detalles del Paquete',\n      3: 'Direcciones',\n      4: 'Configuración del Envío'\n    };\n    return titles[step] || '';\n  }\n  isStepValid(step) {\n    const currentStepBackup = this.currentStep;\n    this.currentStep = step;\n    const isValid = this.validateCurrentStep();\n    this.currentStep = currentStepBackup;\n    return isValid;\n  }\n};\nRealizarEnvioComponent = __decorate([Component({\n  selector: 'app-realizar-envio',\n  templateUrl: './realizar-envio.component.html',\n  styleUrls: ['./realizar-envio.component.css']\n})], RealizarEnvioComponent);","map":{"version":3,"names":["Component","Subscription","RealizarEnvioComponent","constructor","authService","router","http","subscription","apiUrl","currentUser","isLoading","isSubmitting","errorMessage","successMessage","currentStep","totalSteps","shipmentForm","sender","name","phone","email","document_type","document_number","receiver","package_details","description","weight","dimensions","length","width","height","declared_value","fragile","special_handling","addresses","origin","department","municipality","address","zone","reference","destination","service_type","priority","delivery_date","notes","documentTypes","value","label","serviceTypes","price","priorities","color","departments","ngOnInit","loadUserData","setMinDeliveryDate","ngOnDestroy","unsubscribe","add","currentUser$","subscribe","user","prefillSenderData","tomorrow","Date","setDate","getDate","toISOString","split","nextStep","validateCurrentStep","clearMessages","prevStep","goToStep","step","validateSenderReceiver","validatePackageDetails","validateAddresses","validateServiceOptions","trim","onSubmit","shipmentData","user_id","id","created_by_role","role","post","next","response","success","shipment","shipment_id","setTimeout","navigate","queryParams","message","error","status","console","resetForm","getStepTitle","titles","isStepValid","currentStepBackup","isValid","__decorate","selector","templateUrl","styleUrls"],"sources":["C:\\Users\\Ferna\\Desktop\\envios\\DsEnvios\\frontend\\src\\app\\components\\realizar-envio\\realizar-envio.component.ts"],"sourcesContent":["import { Component, OnInit, OnDestroy } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { Subscription } from 'rxjs';\r\nimport { HttpClient, HttpErrorResponse } from '@angular/common/http';\r\nimport { AuthService } from '../../services/auth.service';\r\n\r\ninterface User {\r\n  id: string;\r\n  username: string;\r\n  name: string;\r\n  role: string;\r\n  email: string;\r\n}\r\n\r\ninterface ShipmentForm {\r\n  // Información del remitente\r\n  sender: {\r\n    name: string;\r\n    phone: string;\r\n    email: string;\r\n    document_type: string;\r\n    document_number: string;\r\n  };\r\n  \r\n  // Información del destinatario\r\n  receiver: {\r\n    name: string;\r\n    phone: string;\r\n    email: string;\r\n    document_type: string;\r\n    document_number: string;\r\n  };\r\n  \r\n  // Detalles del paquete\r\n  package_details: {\r\n    description: string;\r\n    weight: number;\r\n    dimensions: {\r\n      length: number;\r\n      width: number;\r\n      height: number;\r\n    };\r\n    declared_value: number;\r\n    fragile: boolean;\r\n    special_handling: string;\r\n  };\r\n  \r\n  // Direcciones\r\n  addresses: {\r\n    origin: {\r\n      department: string;\r\n      municipality: string;\r\n      address: string;\r\n      zone: string;\r\n      reference: string;\r\n    };\r\n    destination: {\r\n      department: string;\r\n      municipality: string;\r\n      address: string;\r\n      zone: string;\r\n      reference: string;\r\n    };\r\n  };\r\n  \r\n  // Configuración del envío\r\n  service_type: string;\r\n  priority: string;\r\n  delivery_date: string;\r\n  notes: string;\r\n}\r\n\r\ninterface ShipmentResponse {\r\n  success: boolean;\r\n  message: string;\r\n  shipment?: {\r\n    shipment_id: string;\r\n    tracking_url: string;\r\n  };\r\n}\r\n\r\n@Component({\r\n  selector: 'app-realizar-envio',\r\n  templateUrl: './realizar-envio.component.html',\r\n  styleUrls: ['./realizar-envio.component.css']\r\n})\r\nexport class RealizarEnvioComponent implements OnInit, OnDestroy {\r\n  private subscription: Subscription = new Subscription();\r\n  private apiUrl = 'http://localhost:3005/api';\r\n  \r\n  currentUser: User | null = null;\r\n  isLoading = false;\r\n  isSubmitting = false;\r\n  errorMessage = '';\r\n  successMessage = '';\r\n  currentStep = 1;\r\n  totalSteps = 4;\r\n  \r\n  shipmentForm: ShipmentForm = {\r\n    sender: {\r\n      name: '',\r\n      phone: '',\r\n      email: '',\r\n      document_type: 'DPI',\r\n      document_number: ''\r\n    },\r\n    receiver: {\r\n      name: '',\r\n      phone: '',\r\n      email: '',\r\n      document_type: 'DPI',\r\n      document_number: ''\r\n    },\r\n    package_details: {\r\n      description: '',\r\n      weight: 0,\r\n      dimensions: {\r\n        length: 0,\r\n        width: 0,\r\n        height: 0\r\n      },\r\n      declared_value: 0,\r\n      fragile: false,\r\n      special_handling: ''\r\n    },\r\n    addresses: {\r\n      origin: {\r\n        department: '',\r\n        municipality: '',\r\n        address: '',\r\n        zone: '',\r\n        reference: ''\r\n      },\r\n      destination: {\r\n        department: '',\r\n        municipality: '',\r\n        address: '',\r\n        zone: '',\r\n        reference: ''\r\n      }\r\n    },\r\n    service_type: 'standard',\r\n    priority: 'normal',\r\n    delivery_date: '',\r\n    notes: ''\r\n  };\r\n  \r\n  // Opciones para selects\r\n  documentTypes = [\r\n    { value: 'DPI', label: 'DPI' },\r\n    { value: 'NIT', label: 'NIT' },\r\n    { value: 'Passport', label: 'Pasaporte' }\r\n  ];\r\n  \r\n  serviceTypes = [\r\n    { value: 'standard', label: 'Estándar (3-5 días)', price: 'Base' },\r\n    { value: 'express', label: 'Express (1-2 días)', price: '+50%' },\r\n    { value: 'overnight', label: 'Overnight (24 horas)', price: '+100%' }\r\n  ];\r\n  \r\n  priorities = [\r\n    { value: 'low', label: 'Baja', color: '#28a745' },\r\n    { value: 'normal', label: 'Normal', color: '#007bff' },\r\n    { value: 'high', label: 'Alta', color: '#ffc107' },\r\n    { value: 'urgent', label: 'Urgente', color: '#dc3545' }\r\n  ];\r\n  \r\n  // Departamentos de Guatemala\r\n  departments = [\r\n    'Alta Verapaz', 'Baja Verapaz', 'Chimaltenango', 'Chiquimula', 'Petén',\r\n    'El Progreso', 'Quiché', 'Escuintla', 'Guatemala', 'Huehuetenango',\r\n    'Izabal', 'Jalapa', 'Jutiapa', 'Quetzaltenango', 'Retalhuleu',\r\n    'Sacatepéquez', 'San Marcos', 'Santa Rosa', 'Sololá', 'Suchitepéquez',\r\n    'Totonicapán', 'Zacapa'\r\n  ];\r\n\r\n  constructor(\r\n    private authService: AuthService,\r\n    private router: Router,\r\n    private http: HttpClient\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.loadUserData();\r\n    this.setMinDeliveryDate();\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.subscription.unsubscribe();\r\n  }\r\n\r\n  private loadUserData(): void {\r\n    this.subscription.add(\r\n      this.authService.currentUser$.subscribe(user => {\r\n        this.currentUser = user;\r\n        if (user) {\r\n          // Pre-llenar datos del usuario actual como remitente por defecto\r\n          this.prefillSenderData(user);\r\n        }\r\n      })\r\n    );\r\n  }\r\n\r\n  private prefillSenderData(user: User): void {\r\n    this.shipmentForm.sender.name = user.name;\r\n    this.shipmentForm.sender.email = user.email;\r\n  }\r\n\r\n  private setMinDeliveryDate(): void {\r\n    const tomorrow = new Date();\r\n    tomorrow.setDate(tomorrow.getDate() + 1);\r\n    this.shipmentForm.delivery_date = tomorrow.toISOString().split('T')[0];\r\n  }\r\n\r\n  // Navegación entre pasos\r\n  nextStep(): void {\r\n    if (this.validateCurrentStep()) {\r\n      if (this.currentStep < this.totalSteps) {\r\n        this.currentStep++;\r\n        this.clearMessages();\r\n      }\r\n    }\r\n  }\r\n\r\n  prevStep(): void {\r\n    if (this.currentStep > 1) {\r\n      this.currentStep--;\r\n      this.clearMessages();\r\n    }\r\n  }\r\n\r\n  goToStep(step: number): void {\r\n    if (step >= 1 && step <= this.totalSteps) {\r\n      this.currentStep = step;\r\n      this.clearMessages();\r\n    }\r\n  }\r\n\r\n  // Validaciones\r\n  validateCurrentStep(): boolean {\r\n    this.clearMessages();\r\n    \r\n    switch (this.currentStep) {\r\n      case 1:\r\n        return this.validateSenderReceiver();\r\n      case 2:\r\n        return this.validatePackageDetails();\r\n      case 3:\r\n        return this.validateAddresses();\r\n      case 4:\r\n        return this.validateServiceOptions();\r\n      default:\r\n        return false;\r\n    }\r\n  }\r\n\r\n  private validateSenderReceiver(): boolean {\r\n    const { sender, receiver } = this.shipmentForm;\r\n    \r\n    if (!sender.name.trim()) {\r\n      this.errorMessage = 'El nombre del remitente es requerido';\r\n      return false;\r\n    }\r\n    \r\n    if (!sender.phone.trim()) {\r\n      this.errorMessage = 'El teléfono del remitente es requerido';\r\n      return false;\r\n    }\r\n    \r\n    if (!sender.document_number.trim()) {\r\n      this.errorMessage = 'El número de documento del remitente es requerido';\r\n      return false;\r\n    }\r\n    \r\n    if (!receiver.name.trim()) {\r\n      this.errorMessage = 'El nombre del destinatario es requerido';\r\n      return false;\r\n    }\r\n    \r\n    if (!receiver.phone.trim()) {\r\n      this.errorMessage = 'El teléfono del destinatario es requerido';\r\n      return false;\r\n    }\r\n    \r\n    if (!receiver.document_number.trim()) {\r\n      this.errorMessage = 'El número de documento del destinatario es requerido';\r\n      return false;\r\n    }\r\n    \r\n    return true;\r\n  }\r\n\r\n  private validatePackageDetails(): boolean {\r\n    const { package_details } = this.shipmentForm;\r\n    \r\n    if (!package_details.description.trim()) {\r\n      this.errorMessage = 'La descripción del paquete es requerida';\r\n      return false;\r\n    }\r\n    \r\n    if (package_details.weight <= 0) {\r\n      this.errorMessage = 'El peso debe ser mayor a 0';\r\n      return false;\r\n    }\r\n    \r\n    if (package_details.dimensions.length <= 0 || \r\n        package_details.dimensions.width <= 0 || \r\n        package_details.dimensions.height <= 0) {\r\n      this.errorMessage = 'Todas las dimensiones deben ser mayores a 0';\r\n      return false;\r\n    }\r\n    \r\n    if (package_details.declared_value <= 0) {\r\n      this.errorMessage = 'El valor declarado debe ser mayor a 0';\r\n      return false;\r\n    }\r\n    \r\n    return true;\r\n  }\r\n\r\n  private validateAddresses(): boolean {\r\n    const { origin, destination } = this.shipmentForm.addresses;\r\n    \r\n    if (!origin.department || !origin.municipality || !origin.address.trim()) {\r\n      this.errorMessage = 'Todos los campos de dirección de origen son requeridos';\r\n      return false;\r\n    }\r\n    \r\n    if (!destination.department || !destination.municipality || !destination.address.trim()) {\r\n      this.errorMessage = 'Todos los campos de dirección de destino son requeridos';\r\n      return false;\r\n    }\r\n    \r\n    return true;\r\n  }\r\n\r\n  private validateServiceOptions(): boolean {\r\n    if (!this.shipmentForm.service_type) {\r\n      this.errorMessage = 'Debe seleccionar un tipo de servicio';\r\n      return false;\r\n    }\r\n    \r\n    if (!this.shipmentForm.priority) {\r\n      this.errorMessage = 'Debe seleccionar una prioridad';\r\n      return false;\r\n    }\r\n    \r\n    if (!this.shipmentForm.delivery_date) {\r\n      this.errorMessage = 'Debe seleccionar una fecha de entrega';\r\n      return false;\r\n    }\r\n    \r\n    return true;\r\n  }\r\n\r\n  // Envío del formulario\r\n  onSubmit(): void {\r\n    if (!this.validateCurrentStep()) {\r\n      return;\r\n    }\r\n    \r\n    this.isSubmitting = true;\r\n    this.clearMessages();\r\n    \r\n    const shipmentData = {\r\n      ...this.shipmentForm,\r\n      user_id: this.currentUser?.id,\r\n      created_by_role: this.currentUser?.role\r\n    };\r\n    \r\n    this.subscription.add(\r\n      this.http.post<ShipmentResponse>(`${this.apiUrl}/shipments`, shipmentData).subscribe({\r\n        next: (response) => {\r\n          this.isSubmitting = false;\r\n          \r\n          if (response.success) {\r\n            this.successMessage = `¡Envío creado exitosamente! ID: ${response.shipment?.shipment_id}`;\r\n            \r\n            // Esperar 3 segundos y redirigir\r\n            setTimeout(() => {\r\n              this.router.navigate(['/rastreo'], { \r\n                queryParams: { id: response.shipment?.shipment_id } \r\n              });\r\n            }, 3000);\r\n          } else {\r\n            this.errorMessage = response.message || 'Error al crear el envío';\r\n          }\r\n        },\r\n        error: (error: HttpErrorResponse) => {\r\n          this.isSubmitting = false;\r\n          \r\n          if (error.status === 401) {\r\n            this.errorMessage = 'No tienes permisos para crear envíos';\r\n            this.router.navigate(['/login']);\r\n          } else if (error.status === 400) {\r\n            this.errorMessage = error.error?.message || 'Datos del formulario inválidos';\r\n          } else {\r\n            this.errorMessage = 'Error interno del servidor. Intenta nuevamente.';\r\n          }\r\n          \r\n          console.error('Error creating shipment:', error);\r\n        }\r\n      })\r\n    );\r\n  }\r\n\r\n  // Utilidades\r\n  private clearMessages(): void {\r\n    this.errorMessage = '';\r\n    this.successMessage = '';\r\n  }\r\n\r\n  resetForm(): void {\r\n    this.currentStep = 1;\r\n    this.shipmentForm = {\r\n      sender: { name: '', phone: '', email: '', document_type: 'DPI', document_number: '' },\r\n      receiver: { name: '', phone: '', email: '', document_type: 'DPI', document_number: '' },\r\n      package_details: {\r\n        description: '', weight: 0, dimensions: { length: 0, width: 0, height: 0 },\r\n        declared_value: 0, fragile: false, special_handling: ''\r\n      },\r\n      addresses: {\r\n        origin: { department: '', municipality: '', address: '', zone: '', reference: '' },\r\n        destination: { department: '', municipality: '', address: '', zone: '', reference: '' }\r\n      },\r\n      service_type: 'standard', priority: 'normal', delivery_date: '', notes: ''\r\n    };\r\n    \r\n    if (this.currentUser) {\r\n      this.prefillSenderData(this.currentUser);\r\n    }\r\n    this.setMinDeliveryDate();\r\n    this.clearMessages();\r\n  }\r\n\r\n  getStepTitle(step: number): string {\r\n    const titles = {\r\n      1: 'Datos Personales',\r\n      2: 'Detalles del Paquete',\r\n      3: 'Direcciones',\r\n      4: 'Configuración del Envío'\r\n    };\r\n    return titles[step as keyof typeof titles] || '';\r\n  }\r\n\r\n  isStepValid(step: number): boolean {\r\n    const currentStepBackup = this.currentStep;\r\n    this.currentStep = step;\r\n    const isValid = this.validateCurrentStep();\r\n    this.currentStep = currentStepBackup;\r\n    return isValid;\r\n  }\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}